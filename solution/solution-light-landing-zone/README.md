# é˜¿é‡Œäº‘è½»é‡çº§Landing Zoneè§£å†³æ–¹æ¡ˆ

æœ¬è§£å†³æ–¹æ¡ˆç”±é˜¿é‡Œäº‘å¼€æ”¾å¹³å°è§£å†³æ–¹æ¡ˆå›¢é˜Ÿå‘å¸ƒï¼Œé’ˆå¯¹å¤šè´¦å·å¿«é€Ÿæ„å»ºç¬¦åˆå®‰å…¨è§„èŒƒã€æ¶æ„å®Œå–„çš„è¿è¡Œç¯å¢ƒã€‚åœ¨æ­¤æ–¹æ¡ˆä¸­æˆ‘ä»¬ä¼šæä¾›å¤šè´¦å·çš„è®¾è®¡ã€èµ„æºç®¡ç†ã€èº«ä»½æƒé™ã€ç½‘ç»œæœ€ä½³å®è·µã€å®‰å…¨åˆè§„åŸºçº¿ç­‰æ–¹é¢çš„è§„èŒƒè®¾è®¡ã€‚å¿«é€Ÿæ­å»ºä¸€ä¸ªå®‰å…¨åˆè§„çš„ä¸Šäº‘ç™»å½•åŒºã€‚

## ğŸ—ï¸ è§£å†³æ–¹æ¡ˆæ¶æ„

### å¤šè´¦å·è®¾è®¡
- **ç®¡ç†è´¦å· (Management Account)**: è´Ÿè´£æ•´ä½“æ²»ç†å’Œç­–ç•¥ç®¡ç†
- **æ—¥å¿—è´¦å· (Log Account)**: é›†ä¸­æ—¥å¿—æ”¶é›†å’Œå®¡è®¡
- **å…±äº«æœåŠ¡è´¦å· (Shared Service Account)**: æä¾›å…±äº«æœåŠ¡å¦‚DNSã€è¯ä¹¦ç­‰
- **å®‰å…¨è´¦å· (Security Account)**: é›†ä¸­å®‰å…¨æœåŠ¡å’Œåˆè§„ç®¡ç†
- **ä¸šåŠ¡è´¦å·**: è¿ç»´ã€å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰ä¸šåŠ¡ç¯å¢ƒ

### æ ¸å¿ƒç»„ä»¶
- **èº«ä»½ç®¡ç†**: CloudSSOç»Ÿä¸€èº«ä»½è®¤è¯ï¼ŒRAMç”¨æˆ·å’Œè§’è‰²ç®¡ç†
- **ç½‘ç»œæ¶æ„**: VPCã€CENã€NATç½‘å…³ã€å®‰å…¨ç»„ç­‰ç½‘ç»œåŸºç¡€è®¾æ–½
- **å®‰å…¨åˆè§„**: åˆè§„åŒ…ã€æ ‡ç­¾ç­–ç•¥ã€æ“ä½œå®¡è®¡ç­‰å®‰å…¨åŸºçº¿
- **èµ„æºç®¡ç†**: èµ„æºç»„ã€æ ‡ç­¾ç®¡ç†ã€æˆæœ¬æ§åˆ¶
- **åº”ç”¨éƒ¨ç½²**: ECSã€ALBç­‰åº”ç”¨åŸºç¡€è®¾æ–½

## ğŸ“‹ å‰ç½®æ¡ä»¶

### è´¦å·è¦æ±‚
- ç®¡ç†è´¦å·å¿…é¡»å…·æœ‰ä¼ä¸šå‘ç¥¨æŠ¬å¤´ï¼Œå¦åˆ™æ— æ³•ä½œä¸ºä»˜æ¬¾è´¦å·
- ç¡®ä¿ç®¡ç†è´¦å·å…·æœ‰è¶³å¤Ÿçš„æƒé™åˆ›å»ºå’Œç®¡ç†å­è´¦å·
- å»ºè®®åœ¨å…¨æ–°ç¯å¢ƒä¸­æ‰§è¡Œï¼Œé¿å…ä¸ç°æœ‰èµ„æºå†²çª

### ç¯å¢ƒè¦æ±‚
- Terraform >= 1.0
- aliyun provider >= 1.205.0
- Python 3.x (ç”¨äºè„šæœ¬æ‰§è¡Œ)
- é˜¿é‡Œäº‘CLIå·¥å…·
- æœ‰æ•ˆçš„é˜¿é‡Œäº‘AccessKeyå’ŒSecretKey

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd solution-light-landing-zone

# Pythonè¿è¡Œç¯å¢ƒåˆå§‹åŒ–
pip3 install alibabacloud_tea_openapi
pip3 install alibabacloud_cbn20170912==1.0.17
pip3 install alibabacloud_tag20180828==1.0.4
pip3 install alibabacloud_tea_console
pip3 install alibabacloud_darabonba_env
pip3 install alibabacloud_sts20150401

# é…ç½®é˜¿é‡Œäº‘å‡­è¯
export ALICLOUD_ACCESS_KEY="your-access-key"
export ALICLOUD_SECRET_KEY="your-secret-key"
```

### 2. é…ç½®æ–‡ä»¶è®¾ç½®
ç¼–è¾‘ `settings.tfvars` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å…³é”®å‚æ•°ï¼š

```hcl
# åŸºç¡€é…ç½®
light_landingzone_region  = "cn-shanghai"  # éƒ¨ç½²åŒºåŸŸ
management_account_id     = "your-management-account-id"
payer_account_id          = "your-payer-account-id"

# è´¦å·ä¿¡æ¯ (é€šè¿‡äº‘æ²»ç†ä¸­å¿ƒæ­å»º)
log_account_id            = "your-log-account-id"
shared_service_account_id = "your-shared-service-account-id"
security_account_id       = "your-security-account-id"

# CloudSSOé…ç½®
cloudsso_directory_name   = "your-directory-name"
```

### 3. æ‰§è¡Œéƒ¨ç½²
```bash
# ä¸€é”®éƒ¨ç½²æ‰€æœ‰ç»„ä»¶
chmod +x run.sh
./run.sh
```

## ğŸ“ è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šè´¦å·å’Œèº«ä»½ç®¡ç†
1. **åˆ›å»ºæˆå‘˜è´¦å·** (`step/resource-create-account`)
   - åœ¨èµ„æºç›®å½•ä¸­åˆ›å»ºä¸šåŠ¡è´¦å·
   - é…ç½®è´¦å·åŸºæœ¬ä¿¡æ¯

2. **åˆ›å»ºCloudSSOç”¨æˆ·** (`step/cloudsso-create-user`)
   - é…ç½®ç»Ÿä¸€èº«ä»½è®¤è¯
   - åˆ›å»ºSSOç”¨æˆ·å’Œæƒé™

3. **åˆ›å»ºRAMç”¨æˆ·å’Œè§’è‰²** (`step/iam-create-user-api-key`)
   - åˆ›å»ºç¨‹åºåŒ–è®¿é—®ç”¨æˆ·
   - é…ç½®APIè®¿é—®å¯†é’¥

4. **æˆæƒRAMç”¨æˆ·ç­–ç•¥** (`step/iam-authorize-user-role`)
   - åˆ†é…ç³»ç»Ÿç­–ç•¥
   - é…ç½®æƒé™è¾¹ç•Œ

### ç¬¬äºŒé˜¶æ®µï¼šèµ„æºç®¡ç†
5. **åˆ›å»ºèµ„æºç»„** (`step/resource-create-group`)
   - æŒ‰ä¸šåŠ¡åˆ’åˆ†èµ„æºç»„
   - é…ç½®èµ„æºç»„ç»‡ç»“æ„

6. **åˆ›å»ºæ ‡ç­¾ç­–ç•¥** (`step/resource-tag`)
   - å®šä¹‰æ ‡ç­¾è§„èŒƒ
   - é…ç½®æ ‡ç­¾ç­–ç•¥

### ç¬¬ä¸‰é˜¶æ®µï¼šå®‰å…¨åˆè§„
7. **å¯ç”¨åˆè§„è§„åˆ™** (`step/com-config-compliance-pack`)
   - é…ç½®åˆè§„åŒ…æ¨¡æ¿
   - å¯ç”¨å®‰å…¨åŸºçº¿æ£€æŸ¥

### ç¬¬å››é˜¶æ®µï¼šç½‘ç»œæ¶æ„
8. **åˆ›å»ºVPCå’Œäº¤æ¢æœº** (`step/network-create-vpc`)
   - æ„å»ºåŸºç¡€ç½‘ç»œæ¶æ„
   - é…ç½®å­ç½‘åˆ’åˆ†

9. **æ„å»ºDMZ VPC** (`step/network-build-vpc-dmz`)
   - åˆ›å»ºDMZç½‘ç»œåŒºåŸŸ
   - é…ç½®å®‰å…¨éš”ç¦»

10. **åˆ›å»ºCENå¹¶è¿æ¥VPC** (`step/network-attach-cen`)
    - é…ç½®äº‘ä¼ä¸šç½‘
    - å®ç°ç½‘ç»œäº’è”

11. **é…ç½®è·¯ç”±** (`step/network-config-route`)
    - è®¾ç½®ç½‘ç»œè·¯ç”±ç­–ç•¥
    - é…ç½®æµé‡è½¬å‘

### ç¬¬äº”é˜¶æ®µï¼šåº”ç”¨éƒ¨ç½²
12. **éƒ¨ç½²ECSå’ŒALB** (`step/application-deploy-ecs-alb`)
    - éƒ¨ç½²åº”ç”¨æœåŠ¡å™¨
    - é…ç½®è´Ÿè½½å‡è¡¡

## ğŸ› ï¸ æ¨¡å—è¯´æ˜

### æ ¸å¿ƒæ¨¡å— (`modules/`)
- `terraform-alicloud-landing-zone-resource-structure/`: èµ„æºç»“æ„ç®¡ç†
- `terraform-alicloud-landing-zone-log-archive/`: æ—¥å¿—å½’æ¡£ç®¡ç†
- `networking/`: ç½‘ç»œåŸºç¡€è®¾æ–½æ¨¡å—
- `compliance-pack/`: åˆè§„åŒ…ç®¡ç†
- `create-cloudsso-and-access/`: CloudSSOå’Œè®¿é—®ç®¡ç†

### éƒ¨ç½²æ­¥éª¤ (`step/`)
æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ç‹¬ç«‹çš„Terraformé…ç½®ï¼Œå¯ä»¥å•ç‹¬æ‰§è¡Œæˆ–æŒ‰é¡ºåºæ‰§è¡Œã€‚

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹è´¦å·ç»“æ„
åœ¨ `settings.tfvars` ä¸­ä¿®æ”¹è´¦å·é…ç½®ï¼š
```hcl
# ä¸šåŠ¡è´¦å·é…ç½®
ops_display_name        = "è¿ç»´è´¦å·"
daily_display_name      = "æµ‹è¯•è´¦å·"
prod_display_name       = "ç”Ÿäº§è´¦å·"
```

### è°ƒæ•´ç½‘ç»œé…ç½®
ä¿®æ”¹VPCå’Œå­ç½‘é…ç½®ï¼š
```hcl
# VPCé…ç½®
vpc_cidr_block = "10.0.0.0/16"
vswitch_cidr_blocks = ["10.0.1.0/24", "10.0.2.0/24"]
```

### é…ç½®åˆè§„è§„åˆ™
é€‰æ‹©é€‚åˆçš„åˆè§„åŒ…æ¨¡æ¿ï¼š
```hcl
# åˆè§„åŒ…æ¨¡æ¿ID
# "OSSåˆè§„ç®¡ç†æœ€ä½³å®è·µ": "ct-a5edff4e06a3004a5e15"
# "ç½‘ç»œåˆè§„ç®¡ç†æœ€ä½³å®è·µ": "ct-d254ff4e06a300cfc654"
# "è´¦å·æƒé™åˆè§„ç®¡ç†æœ€ä½³å®è·µ": "ct-d264ff4e06a300a9c2d0"
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### éƒ¨ç½²å‰æ£€æŸ¥
- **ç¯å¢ƒéš”ç¦»**: å»ºè®®åœ¨å…¨æ–°ç¯å¢ƒä¸­æ‰§è¡Œï¼Œé¿å…ä¸ç°æœ‰èµ„æºå†²çª
- **æƒé™éªŒè¯**: ç¡®ä¿ç®¡ç†è´¦å·å…·æœ‰è¶³å¤Ÿçš„æƒé™åˆ›å»ºå­è´¦å·å’Œèµ„æº
- **é…ç½®å¤‡ä»½**: éƒ¨ç½²å‰å¤‡ä»½ç°æœ‰é…ç½®ï¼Œé¿å…æ•°æ®ä¸¢å¤±

### æ‰§è¡Œè¿‡ç¨‹ä¸­
- **è¶…æ—¶å¤„ç†**: æŸäº›æ“ä½œå¯èƒ½è¶…æ—¶ï¼Œå¯ä»¥é‡è¯•æ‰§è¡Œ
- **çŠ¶æ€ç®¡ç†**: æ¯ä¸ªæ­¥éª¤æ‰§è¡Œå®Œæˆåæ£€æŸ¥TerraformçŠ¶æ€
- **æ—¥å¿—ç›‘æ§**: å…³æ³¨æ‰§è¡Œæ—¥å¿—ï¼ŒåŠæ—¶å¤„ç†é”™è¯¯

### éƒ¨ç½²åéªŒè¯
- **è´¦å·éªŒè¯**: ç¡®è®¤æ‰€æœ‰è´¦å·åˆ›å»ºæˆåŠŸ
- **ç½‘ç»œè¿é€šæ€§**: æµ‹è¯•VPCé—´ç½‘ç»œè¿é€šæ€§
- **å®‰å…¨ç­–ç•¥**: éªŒè¯å®‰å…¨ç»„å’Œåˆè§„è§„åˆ™ç”Ÿæ•ˆ
- **åº”ç”¨è®¿é—®**: æµ‹è¯•åº”ç”¨æœåŠ¡å¯æ­£å¸¸è®¿é—®

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **è´¦å·åˆ›å»ºå¤±è´¥**
   - æ£€æŸ¥ç®¡ç†è´¦å·æƒé™
   - éªŒè¯è´¦å·IDé…ç½®æ­£ç¡®æ€§

2. **ç½‘ç»œè¿æ¥é—®é¢˜**
   - æ£€æŸ¥CENé…ç½®
   - éªŒè¯è·¯ç”±è¡¨è®¾ç½®

3. **åˆè§„è§„åˆ™ä¸ç”Ÿæ•ˆ**
   - ç¡®è®¤åˆè§„åŒ…æ¨¡æ¿IDæ­£ç¡®
   - æ£€æŸ¥è§„åˆ™å‚æ•°é…ç½®

### æ¸…ç†èµ„æº
å¦‚éœ€æ¸…ç†å·²éƒ¨ç½²çš„èµ„æºï¼Œè¯·æŒ‰ç›¸åé¡ºåºæ‰§è¡Œï¼š
```bash
# æŒ‰æ­¥éª¤æ¸…ç†èµ„æº
cd step/application-deploy-ecs-alb && terraform destroy
cd ../network-config-route && terraform destroy
# ... ç»§ç»­å…¶ä»–æ­¥éª¤
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥æ‰§è¡Œæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
2. å‚è€ƒé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£
3. è”ç³»é˜¿é‡Œäº‘æŠ€æœ¯æ”¯æŒ

## ğŸ“„ è®¸å¯è¯

æœ¬è§£å†³æ–¹æ¡ˆéµå¾ªç›¸å…³å¼€æºè®¸å¯è¯ï¼Œå…·ä½“è¯·æŸ¥çœ‹LICENSEæ–‡ä»¶ã€‚

---

**æ³¨æ„**: æœ¬æ–¹æ¡ˆä¸ºç”Ÿäº§ç¯å¢ƒè®¾è®¡ï¼Œè¯·åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚